# 106, 200
import os
import pandas as pd
from datetime import datetime, timedelta
from openpyxl import load_workbook

# 배열 정의
# 신경안정제 배열에 포함된 항목
anxiolytics = ['carbamazepine', 'clonazepam', 'diphenylhydantoin sodium', 'phenytoin sodium', 'divalproex sodium', 'divalproex sodium (as divalproex)', 'divalproex sodium particle (as divalproex)', 'divalproex sodium particle', 'ethosuximide', 'gabapentin', 'lamotrigine', 'oxcarbazepine', 'oxcarbazepin', 'primidone', 'sodium valproate', 'sodium valproate(sodium valproate 333.30mg', 'valproic acid 145.14mg)', 'sodium valproate(as valproic acid)   500mg', 'sodium valproate(sodium valproate 66.66mg', 'valproic acid 29.03mg)', 'sodium valproate(sodium valproate 166.76mg', 'valproic acid 72.61mg)', 'sodium valproate(sodium valproate 500.06mg', 'valproic acid 217.75mg)', 'sodium valproate(sodium valproate 666.60mg', 'valproic acid 290.27mg)', 'topiramate', 'valproate magnesium', 'valproic acid', 'vigabatrin', 'zonisamide', 'diphenylhydantoin', 'phenobarbital', 'phenytoin', 'pheneturide', 'tetrabenazine', 'levetiracetam', 'stiripentol', 'fosphenytoin sodium', 'rufinamide', 'cabergoline', 'tiagabine HCl monohydrate', 'Lacosamide', 'perampanel (as perampanel anhydrate)', 'brivaracetam', 'deutetrabenazine', 'cannabidiol', 'eslicarbazepine acetate', 'perampanel(micronized)', 'betahistine mesilate', 'cinnarizine', 'difenidol hydrochloride', 'dimenhydrinate', 'betahistine hydrochloride', 'isosorbide concentrate', 'caffeine anhydrous', 'pyridoxine hydrochloride', 'pyridoxine HCl', 'meclizine HCl', 'scopolamine HBr', 'alprazolam', 'amineptine HCl', 'amitriptyline HCl', 'amitriptyline hydrochloride', 'amoxapine', 'amytal sodium', 'bromazepam', 'bromperidol', 'buspirone hydrochloride', 'chlordiazepoxide hydrochloride', 'chlorpromazine hydrochloride', 'chlorpromazine HCl', 'chlorprothixene', 'zuclopenthixol', 'clobazam', 'clomipramine hydrochloride', 'clomipramine HCl', 'clorazepate dipotassium', 'clotiazepam', 'clozapine', 'diazepam', 'dothiepin HCl', 'doxepin HCl', 'dried kava kava root extract', 'droperidol', 'ethyl loflazepate', 'etizolam', 'fludiazepam', 'fluoxetine hydrochloride (as fluoxetine)', 'fluoxetine HCl', 'flupentixol decanoate', 'flupentixol HCl', 'fluvoxamine maleate', 'haloperidol', 'haloperidol decanoate', 'haloperidol decanoate (as haloperidol)', 'hydroxyzine hydrochloride', 'hydroxyzine HCl', "St. John's Wort 80% methanol ext.", 'imipramine hydrochloride', 'levomepromazine maleate (as levomepromazine)', 'lithium carbonate', 'lorazepam', 'loxapine', 'maprotiline HCl', 'medifoxamine fumarate', 'melperone HCl', 'mesoridazine besylate', 'mexazolam', 'mianserine HCl', 'minaprin HCl', 'mirtazapine', 'moclobemide', 'molindone hydrochloride', 'molindone HCl', 'nefazodone', 'nefazodone HCl', 'nemonapride', 'nordazepam', 'nortryptiline hydrochloride (as nortryptiline)', 'olanzapine', 'paroxetine hydrochloride (as paroxetine)', 'paroxetine HCl  (as paroxetine)', 'paroxetine HCl(as paroxetine)   25mg', 'perphenazine', 'perphenazine hydrochloride', 'pimozide', 'pinazepam', 'quinupramine', 'risperidone', 'risperidone extended release microspheres (as risperidone)', 'sertraline hydrochloride (as sertraline)', 'setiptilin maleate', 'sodium tianeptine', 'sulpiride', 'thioridazine HCl', 'thiothixene', 'tofisopam', 'tolaxatone', 'trazodone hydrochloride', 'trazodone HCl', 'triflupromazine HCl', 'venlafaxin HCl', 'venlafaxine hydrochloride (as venlafaxine)', 'zotepin', 'chlordiazepoxide', 'clidinium bromide', 'etifoxine hydrochloride', 'milnacipran hydrochloride', 'quetiapine fumarate (as quetiapine)', 'oxazepam', 'deoxyactein', 'hypericin', 'flutoprazepam', 'amisulpride', 'bupropion hydrochloride', 'bupropion HCl', 'citalopram hydrobromide (as citalopram)', 'aripiprazole', 'aripiprazole', 'ziprasidone hydrochloride monohydrate (as ziprasidone)', 'escitalopram oxalate (as escitalopram)', 'tandospirone citrate', 'duloxetine hydrochloride (as duloxetine)', 'duloxetine hydrochloride (as duloxetine', 'decitabine 50mg', 'paliperidone', 'blonanserin', 'escitalopram', 'oxazolam', 'ziprasidone mesylate trihydrate', 'paliperidone palmitate(as paliperidone)', 'paliperidone palmitate (as paliperidone)', 'mosapramine', 'agomelatine', 'desvenlafaxine succinate monohydrate (as desvenlafaxine)', 'vortioxetine hydrobromide (as vortioxetine)', 'desvenlafaxine benzoate (as desvenlafaxine)', 'desvenlafaxine', 'esketamine hydrochloride (as esketamine)', 'acamprosate', 'afloqualone', 'amantadine sulfate', 'benztropine mesylate', 'bovine cerebral phospholipid', 'cladribine', 'clonidine hydrochloride', 'choline alfoscerate', 'donepezil hydrochloride', "St. John's Wort 50% ethanol ext. (as hypericin)", 'dried hyperici 60% ethanol ext.(5.6→1)', 'levodopa', 'meclofenoxate hydrochloride', 'meclofenoxate HCl', 'memantine hydrochloride (as memantine)', 'memantine HCl', 'memantine hydrochloride', 'oxiracetam', 'pemolline', 'pergolide mesylate', 'piracetam', 'procyclidine hydrochloride', 'pyrisuccideanol maleate', 'riluzole', 'rivastigmine tartrate (as rivastigmine)', 'rivastigmine', 'ropinirole hydrochloride (as ropinirole)', 'selegiline hydrochloride', 'tacrin', 'tiapride HCl', 'trifluoperazine hydrochloride', 'trifluoperazine hydrochloride (as trifluoperazine)', 'ursodeoxycholic acid', 'benserazide HCl', 'benserazide hydrochloride (as benserazide)', 'carbidopa hydrate (as carbidopa)', 'pyridoxine HCl', 'sulpiride', 'carnitine chloride', 'cyanocobalamin', 'cyproheptadine orotate', 'lysine HCl', 'benzocaine', 'carbidopa', 'galantamine hydrobromide', 'galantamine hydrobromide (as galantamine)', 'pramipexole dihydrochloride', 'glatiramer acetate', 'entacapone', 'carbidopa monohydrate (as carbidopa)', 'Pregabalin', 'atomoxetine hydrochloride (as atomoxetine)', 'alemtuzumab', 'Rotigotine', 'fingolimod hydrochloride (as fingolimod)', 'fampridine', 'teriflunomide', 'rasagiline mesylate (as rasagiline)', 'rasagiline tartrate (as rasagiline)', 'taltirelin hydrate', 'carbidopa hydrate', 'donepezil', 'edaravone', 'dimethyl fumarate', 'armodafinil', 'nusinersen sodium (as nusinersen)', 'galcanezumab', 'idebenone', 'opicapone', 'safinamide mesylate (as safinamide)', 'satralizumab', 'mirogabalin besilate (as mirogabalin)', 'inebilizumab', 'pitolisant hydrochloride (as pitolisant)', 'valvenazine ditosylate (as valvenazine)', 'cimicifuga rhizome 50% ethanol dried ext.', 'hyperici 60% ethanol dried ext.', 'cimicifuga rhizome ext.', 'dried hyperici ext.', 'ascorbic acid', 'L-arginine-L-aspartate', 'cobamamide', 'dl-carnitine hydrochloride', 'L-lysine hydrochloride', 'hematoporphyrin-cysteine', 'L-arginine-L-aspartate hydrate', 'hypericum', 'dl-carnitine HCl']
# 진통제 배열에 포함된 항목
painkillers = ['aceclofenac', 'acemetacin', 'acetaminophen', 'acetaminophen(encapsulated)', 'acetaminophen encapsulated', 'acetaminophen encapsulated(as acetaminophen)', 'alminoprofen', 'aloxiporin', 'amfenac sodium', 'aspirin', 'aspirin(encapsulated)', 'aspirin lysine', 'auranofin', 'benorylate', 'benzydamine hydrochloride', 'bumadizone calcium semihydrate', 'buprenorphine HCl', 'buprenorphine hydrochloride', 'butorphanol tartrate', 'choline magnesium trisalicylate', 'cinnoxicam', 'clonixin lysinate', 'dexamethasone palmitate', 'dexibuprofen', 'dexibuprofen', 'diclofenac', 'diclofenac potassium', 'diclofenac sodium', 'diclofenac-β-dimethyl-aminoethanol', 'difenpiramide', 'diflunisal lysine', 'dihydroergotamine mesylate', 'emorfazone', 'enfenamic acid', 'eptazocine', 'ergotamine tartrate', 'etodolac', 'etofenamate', 'fenbufen', 'fenoprofen calcium', 'flufenamic acid', 'flurbiprofen', 'glucamethacin', 'glucosamine sulfate', 'glucosamine(S)', 'harpagophyti ext.', 'hydroxocobalamin', 'ibuprofen', 'ibuprofen encapsulated', 'ibuproxam', 'imidazole salicylate', 'immunoglobulin', 'indomethacin', 'ketoprofen', 'ketoprofen lysine', 'ketoprofen lysinate', 'ketorolac tromethamine', 'lonazolac calcium', 'loxoprofen sodium hydrate (as loxoprofen sodium)', 'loxoprofen sodium', 'loxoprofen sodium hydrate(as loxoprofen sodium)', 'meclofenamate sodium', 'mefenamic acid', 'meloxicam', 'methotrexate', 'nabumetone', 'nalbuphine HCl', 'nalbuphine hydrochloride', 'naproxen', 'naproxen sodium', 'nefopam hydrochloride', 'nimesulide', 'oxaprozin', 'pentazocine hydrochloride', 'pentazocine HCl', 'pentazocine', 'piroxicam', 'piroxicam potassium', 'piroxicam potassium (as piroxicam)', 'piroxicam β-cyclodextrin', 'piroxicam β-cyclodextrin (as piroxicam)', 'pranoprofen', 'proglumetacin maleate', 'propacetamol hydrochloride', 'pyrazinobutazone', 'salsalate', 'sodium aurothiomalate', 'sodium salicylate', 'spleen hydrolysate', 'sulindac', 'sulpyrin', 'sumatriptan succinate', 'sumatriptan succinate (as sumatriptan)', 'talniflumate', 'tenoxicam', 'tiaprofenic acid', 'tolfenamic acid', 'tramadol hydrochloride', 'tramadol HCl', 'trometamol tiaprofenate', 'zaltoprofen', 'chlorzoxazone', 'caffeine anhydrous', '1% misoprostol powder (as misoprostol)', 'ethenzamide', 'isopropylantipyrine', 'pseudoephedrine HCl', 'triprolidine HCl', 'salicylamide', 'chlorpheniramine maleate', 'pseudoephedrine hydrochloride', 'dichloralphenazone', 'isometheptene mucate', 'citric acid', 'phenylephrine HCl', 'glycine dihydroxyaluminum', 'magnesium carbonate', 'codeine phosphate', 'dimethylaminoethanol bitartrate', 'methylephedrine HCl', 'dextromethorphan Hbr', 'thiamine nitrate', 'phenylpropanolamine HCl', 'dextromethorphan hydrobromide', 'allylisopropyl acetylurea', 'bisbenthiamine', 'caffaine anhydrous', 'aspirine', 'mag. carbonate', 'mag. oxide', 'prec. cal. carbonate', 'cyanocobalamin', 'pyridoxine HCl', 'lysozyme chloride', 'methylephedrine hydrochloride', 'guaifenesin', 'caffeine', '㎗-chlorpheniramine maleate', 'noscapine', 'cloperastine hydrochloride', 'dl-chlorpheniramine maleate', 'dl-methylephedrine hydrochloride', 'serratiopeptidase', 'cloperastine HCl', '㎗-methylephedrine HCl', 'dℓ-methlephedrine HCl', 'cytidine', 'pyridoxine hydrochloride', 'thiamine hydrochloride', 'uridine', 'thiamine HCl', 'potassium guaiacolsulfonate', '갈근당 ext. powder', 'anhydrous caffeine', 'riboflavin', 'calcium bromide', 'dextrose', 'dl-methionine', 'celecoxib', 'rofecoxib', 'bucillamine', 'lornoxicam', 'doxylamine succinate', 'pseudoephedrin HCl', 'mepirizole', 'floctafenine', 'ascorbic acid', 'fursultiamine', 'proquazone', 'diphenhydramine citrate', 'caffein anhydrous', 'arginine', 'niflumic acid', 'lysozime chloride', 'diphenhydramine hydrochloride', 'magnesium salicylate', 'tiaramide HCl', 'fursulthiamine', 'pseudoephedrine', 'domperidone maleate', 'naratriptan hydrochloride (as naratriptan)', 'zolmitriptan', '위령선', '괄루근', '하고초 30% ethanol ext.', 'sucralfate', 'pseudoephedrine hydrochloride', 'dried ginseng ext.(14.5→1)', 'glycyrrhiza ext. powder(14.3→1)', '갈근탕엑스(10→1)', 'crude glycyrrhiza extract', 'powdered platycodon ext.', '소청룡탕엑스(13→1)', 'rizatriptan benzoate', 'dexketoprofen trometamol (as dexketoprofen)', 'dexketoprofen trometamol', 'dexketoprofen trometamol (as dexketoprofen 50mg)', 'carbinoxamine maleate', 'morniflumate', 'diflunisal', 'pelubiprofen', 'almotriptan maleate (as almotriptan)', 'tolmetin sodium (as tolmetin)', 'frovatriptan succinate monohydrate (as frovatriptan)', '자오가·우슬·방풍·두충·구척·흑두 dried ext.(20→1)', 'esomeprazole magnesium (as esomeprazol)', 'esomeprazole strontium tetrahydrate (as esomeprazol)', 'esomeprazole', 'fentiazac', 'aluminum flufenamate', 'butalbital', 'eptazocine HBr', 'dried honey bee venom', 'dl-methylephedrine HCl', 'glycyrrhiza ext. powder(5→1)', 'platycodon root ext. powder(10→1)', 'naloxone HCl', 'lumbricidae ext. powder', 'platycodon root 45% ethanol ext.powder', 'ibuprofen lysine', 'salicis cortex 70% ethanol dry ext. (6-12→1)', '당귀·목과·방풍·속단·오가피·우슬·위령선·육계·진교·천궁·천마·홍화 25% ethanol soft ext.(3.5→1)', 'polmacoxib', 'etoricoxib', 'magnesium aluminometasilicate', 'apricot kernel', 'cinnamon bark', 'ephedra herb', 'licorice', 'pelubiprofen tromethamine (as pelubiprofen)', 'ibuprofen sodium dihydrate', 'lasmiditan hemisuccinate (as lasmiditan)', 'bisbentiamine', 'brompheniramine maleate', 'ephedrine HCl', 'ephedrine hydrochloride', 'phenylephrine hydrochloride', 'aspirin encapsulated', 'diphenhydramine HCl', 'pheniramine maleate', 'dihydroxyaluminum aminoacetate', 'ibuprofen sodium', 'ibuprofen sodium dihydrate (as ibuprofen)', '갈근탕연조엑스', '갈근탕연조엑스(2.78→1)', '진광탕연조엑스', 'tiemonium iodide', 'mannitol', 'benzyl mandelate', 'triprolidine hydrochloride', 'glucosamine HCl', 'd-chlorpheniramine maleate', 'magnesium oxide', 'caffeine hydrate', 'glycyrrhiza powder', 'peony root powder', 'microcrystalline cellulose', '소청룡탕연조엑스', 'monosodium L-aspartate', 'glycine', 'glycyrrhiza dried ext.(5→1)', 'riboflavin sodium phosphate', '아스피린전분혼합물', 'ascorbic acid granule', 'thiamine nitrate(3배산)', 'tipepidine hibenzate', '갈근탕엑스', 'tipepidine citrate', '갈근탕연조엑스(3→1)', 'ascorbic acid coated', 'noscapine HCl', '소청룡탕엑스분말', '소시호탕건조엑스', 'ascorbic acid gr.', 'serratiopeptidase enteric gr.', 'clematidis radix', 'trichosanthes root', 'prunella spike 30% ethanol ext.(40→1)', '갈근탕엑스분말 (6→1)', '갈근탕건조엑스(5.78→1)', '소청룡탕건조엑스(13→1)', 'carbetapentane citrate', 'ginseng dried ext.', 'oriental bezoar', 'pentoxyverine citrate', 'glycyrrhiza ext.', 'platycodon root fluid ext.', 'green tea powder', 'valerian root ext.(5→1)', 'glycyrrhiza ext. powder', '향소산엑스', '갈근탕엑스분말', '향소산', 'aluminum aspirin', 'fursultiamine hydrochloride', 'isopropamide iodide', 'tranexamic acid', '소청룡탕건조엑스(4.4→1)', 'platycodon root dried ext. powder', 'coptis rhizome ext. powder', 'platycodon root ext. powder', '향소산건조엑스(5.3→1)', '소청룡탕엑스', 'riboflavin(3배산)', 'ascorbic acid 97% gr.', '향소산건조엑스(8→1)', 'ginseng dried ext..(20→3)', 'glycyrrhizae radix dry ext.(100→7)', 'lactose monohydrate', 'glycyrrhiza dried ext.(100→7)', 'platycodon root dried ext.(10→1)', 'citrus unshiu peel', 'cyperus rhizome', 'ginger', 'glycyrrhiza', 'perilla herb', 'cinnamon bark dried ext.(31.3→1)', 'platycodon root 50% ethanol dried ext. (10→1)', 'ginseng ext. powder(14→1)', 'glycyrrhiza dried ext', 'lumbricidae ext.(7.7→1)', 'platycodon root powder', 'jujube', 'peony root', 'pueraria root', 'semi-alkaline protease', 'platycodon root 50% ethanol dried ext.(10→1)', '향소산엑스(5.82→1)', 'choline salicylate solution', 'platycodon root ext.(10→1)', 'cinnamon bark powder', 'polygala root powder', '소청룡탕건조엑스', '향소산건조엑스', 'acetaminophen', 'riboflavin', 'glycyrrhiza ext.(4→1)', 'asiasarum root', 'pinellia tuber', 'schisandra fruit', 'citrus unshiu peel dried ext.', 'cinnamon bark dried ext.(31.25→1)', 'ascorbic acid granule 97%', 'bupleurum root', 'ginseng', 'zingiberis rhizoma crudus', 'scutellaria root', 'ascorbic acid gr. 97%', 'raw ginger', 'Bromovalerylurea', '향소산연조엑스(3.14→1)', '갈근탕연조엑스(3.33→1)', '향소산건조엑스(5.79→1)', 'ethaverine HCl', 'noscapine hydrochloride', 'pamabrom', 'liriope tuber', 'oryzae semen', 'glycyrrhiza ext. powder(5→1) (as glycyrrhizic acid)', 'oriental bezoar (as conjugated bilirubin)', 'dl-methylephedrine', 'benfotiamine', 'glycyrrhiza dried ext.(7.8→1)', 'lysozyme HCl', 'peony root ext. powder', 'Dextromethorphan Hydrobromide Hydrate', 'ANTELOPIS CORNU', 'ARCTI Semen', 'Clycyrrhiza', 'Liquorice Root', 'Forsythia Fruit', 'GLYCINE SEMEN PREPARATUM', 'Lonicera Flower', 'LOPHATHERI HERBA', 'Mentha Herb', 'Platycodon Root', 'Schizonepeta Spike', 'sodium bicarbonate', 'coated ascorbic acid', 'lysozyme hydrochloride', 'thiamine nitrate rocoat', 'ibuprofen arginine', 'ibuprofen arginine (as ibuprofen)', 'liriope tuber soft ext.(2.7→1)', 'powdered plolygala root', 'liriope tuber soft ext.', '방기황기탕건조엑스(7.52→1)', 'platycodon root ext. powder(3.7→1)', 'galgeun-tang ext.(10→1)', 'ibuprofen lysine (as ibuprofen)', 'triprolidine hydrochloride', '소청룡탕연조엑스(2.77→1)', '갈근탕연조엑스(3->1)', '갈근탕 연조엑스(3.33→1)', '소청룡탕건조엑스(13:1)', '향소산건조엑스(8->1)', 'glycyrrhiza ext.(5:1)', 'riboflavin phosphate sodium', '백삼건조엑스(20→3)', '갈근탕연조엑스(3.08→1)', '소청룡탕연조엑스(1.67→1)', '건조엑스로서', '이상수침건조엑스', 'dextromethorphan hydrobromide', 'powdered cinnamon bark', 'ascorbic acid', 'licorice dried ext.(5→1)', '갈근탕건조엑스(4→1)', 'ascorbic acid granules 97%', 'hyangsosan soft ext. (3.14→1)', 'noscapine hydrochloride hydrate', 'triprolidine hydrochloride hydrate', 'citrus unshiu peel ext.(5→1)', 'galgeun-tang dried ext.(4→1)', '갈근탕 건조엑스(10→1)', 'dl-methylephedrine maleate', 'riboflavin butyrate', 'alclometasone dipropionate', 'amcinonide', 'ammonium lactate', 'ammonium lactate solution', 'betamethasone valerate', 'biphenyl acetic acid', 'budesonide', 'buprenorphine', 'butenafine hydrochloride', 'capsaicin', 'clobetasol propionate', 'clobetasone butyrate', 'crotamiton', 'desonide', 'desoxymethasone', 'dexamethasone propionate', 'diclofenac diethylammonium', 'diclofenac diethylammonium (as diclofenac sodium)', 'diclofenac diethylammonium (as diclofenac)', 'diclofenac sodium', 'diflorasone diacetate', 'diflucortolone valerate', 'etofenamate', 'fluocinolone acetonide', 'fluocinonide', 'flurbiprofen', 'fluticasone propionate', 'halcinonide', 'hydrocortisone', 'hydrocortisone acetate', 'hydrocortisone butyrate', 'hydrocortisone valerate', 'ibuprofen', 'indomethacin', 'ketoprofen', 'ketoprofen lysinate', 'ketoprofen(f.)', 'ketoprofen(f.) (서방형)', 'lidocaine', 'loxoprofen sodium', 'methylprednisolone aceponate', 'peppermint oil', 'piroxicam', 'prednicarbate', 'prednisolone valeroacetate', 'triamcinolone acetonide', 'aescin', 'diethylamine salicylate', 'calamine', 'zinc oxide', 'calamine lotion', 'phenol liqudfied', 'hydroxypropyl methylcellulose-2910', 'nonylic acid vanillylamide', 'menthol', 'methylsalicylate', 'thymol', 'vanillyl nonylamide', 'phenol', 'camphor', 'methyl salicylate', 'dexpanthenol', 'dimethylsulfoxide', 'heparin sodium', 'fiufenamic acid', 'glycol salicylate', 'mucopolysaccharide polysulfate', 'benzylalcohol', 'l-menthol', 'mentha oil', 'tocopherol acetate', 'diphenhydramine hydrochloride', 'eucalyptus oil', 'menthae oil', 'nonyl vanilylamide', 'terpin oil', 'chlorpheniramine maleate', 'dibucaime hydrochloride', 'dl-camphor', 'glycyrrhetic acid', 'dibucaine hydrochloride', 'diphenhydramine', 'β-butoxyethyl nicotinate', 'diphenhydramine HCl', 'gardenia fruit soft ext.(3→1)', 'phellodendron bark soft ext.(3.3→1)', 'gardenia fruit soft ext.', 'phellodendron bark soft ext.', 'borneol', 'manthae oil', 'mometasone furoate', 'prednisolone farnesylate', 'clematidis radix', 'monordicae semen', 'myrrha', 'olibanum', 'ricini semen', '㎗-camphor', 'felbinac', 'soluble azulene', 'betamethasone  valerate', 'gentamicin sulfate', 'diclofenac epolamine (as diclofenac)', 'betamethasone valerate (as betamethasone)', 'betamethasone dipropionate', 'clotrimazole', 'arnica tinc.', 'benzyl nicotinate', 'cajeput oil', 'juniper tinc.(10→1)', 'benzethonium chloride', 'macrogol laurylether', 'urea', 'heparinoids', 'capsicum ext.', 'lidocaine hydrochloride', 'mepiramine maleate', 'indometacin', 'capsicum soft ext.(15→1)', 'gardenia fruit ext.(8→1)', 'capsicum powder', 'capsicum tinc.', 'sodium fusidate', 'glycyrrhizinic acid', 'dipotassium glycyrrhizinate', 'guaiazulene', 'aesculus hippocastanum l. seeds ethanol', 'diphenhydramine salicylate', 'clove oil', 'benzocaine', 'borneolum', 'dibucaine HCl', 'zanthoxylum fruit 30% ethanol soft ext.(3.3→1)', 'prednisolone acetate', 'momordicae semen', 'sulfur', 'resina pini', 'yellow beeswax', 'clematidis  radix', 'methyl  salicylate', 'momordicae  semen', 'musk', 'notoginseng  radix', 'resina  pini', 'ricini  semen', 'yellow  beeswax', 'zinc  oxide', 'gardenia fruit soft ext.(3.0→1)', 'angelica gigas root soft ext.', 'lithospermum root soft ext.', 'zanthoxylum fruit 30% ethanol soft ext.', 'zanthoxylum fruit soft ext.', 'gardenia fruit soft dxt.(3→1)', 'glycyrrhizic acid', 'd-camphor', 'enoxolone', 'Lidocaine Hydrochloride Hydrate', 'lidocaine HCl', 'isopropyl methylphenol', 'allantoin', 'tocopherol', 'gardenia fruit soft extract (3.0→1)', 'phellodendron bark soft extract (3.3→1)', 'fusidic acid']
# 수면제 배열에 포함된 항목
sleeping_pills = ['brotizolam', 'chloral hydrate', 'doxepin hydrochloride (as doxepin)', 'doxylamine succinate', 'estazolam', 'flunitrazepam', 'flurazepam hydrochloride', 'midazolam', 'midazolam maleate', 'pentobarbital sodium', 'phenobarbital', 'phenobarbital sodium', 'triazolam', 'zolpidem tartrate', 'zopiclone', 'zolpidem tartarate', 'hyperici ext.', 'kava-kava ext.', 'loprazolam mesilate', 'lormetazepam', 'haloxazolam', 'quazepam', 'dexmedetomidine hydrochloride', 'dexmedetomidine hydrochloride (as dexmedetomidine)', 'melatonin', 'eszopiclone', 'melissa folium 30% methanol dried ext.', 'valerian root dried ext.', 'melissa folium 30% ethanol dried ext.', 'valerian root 70% ethanol dried ext.', 'diphenhydramine hydrochloride', 'hops ext.(5.5→1)', 'passiflora ext.(5.9→1)', 'valerian root 40% methanol ext.(5→1)', 'hops ext.', 'passiflora 30% ethanol ext.', 'uncariae ramulus et uncus ext.', 'valerian root ext.', 'dried hop 45% methanol ext. (7-10→1)·maltodextrin·silica', 'colloidal anhydrous mixture(70:29.8:0.2)', '길초근45%메탄올건조엑스(5∼8→1)·말토덱스트린·무수콜로이드성이산화규소혼합물(75:24.8:0.2)']  
# 각성제주(흥분제) 배열에 포함된 항목
stimulants = ['methylphenidate HCl', 'methylphenidate hydrochloride', 'modafinil', 'caffeine anhydrous']  
# 혈압강하제 배열에 포함된 항목
antihypertensives = ['alacepril', 'amlodipine besylate (as amlodipine)', 'amosulalol hydrochloride', 'barnidipine hydrochloride', 'benazepril hydrochloride', 'benazepril HCl', 'benidipine hydrochloride', 'betaxolol hydrochloride', 'bevantolol hydrochloride', 'bevantolol HCl', 'bunazosin HCl', 'candesartan cilexetil', 'captopril', 'carvedilol', 'cicletanine hydrochloride', 'cilazapril', 'cilnidipine', 'clonidine HCl', 'cloranolol HCl', 'delapril HCl', 'doxazosin mesylate (as doxazocin)', 'doxazocin mesylate', 'enalapril maleate', 'felodipine', 'fosinopril sodium', 'hydralazine hydrochloride', 'hydralazine HCl', 'imidapril hydrochloride', 'indoramin HCl', 'irbesartan', 'isradipine', 'labetalol HCl', 'labetalol hydrochloride', 'lacidipine', 'lisinopril', 'losartan potassium (as losartan)', 'manidipine hydrochloride', 'methyldopa', 'minoxidil', 'moexipril hydrochloride', 'moxonidine', 'nicardipine HCl', 'nicardipine hydrochloride', 'nilvadipine', 'nipradilol', 'penbutolol sulfate', 'perindopril tertbutylamine', 'prazosin HCl', 'quinapril hydrochloride (as quinapril)', 'ramipril', 'reserpine', 'sodium nitroprusside', 'spirapril HCl', 'temocapril hydrochloride', 'temocapril hydrochoride', 'terazosin HCl', 'trandolapril', 'tripamide', 'valsartan', 'acebutolol HCl', 'hydrochlorothiazide', 'atenolol', 'chlorthalidone', 'metoprolol succinate', 'metoprolol tartrate', 'spironolactone', 'polythiazide', 'dihydralazine sulfate', 'inositol hexanicotinate', 'mefruside', 'nisoldipine', 'rilmenidine dihydrogenphosphate', 'indapamide', 'perindopril tetrabutylamine', 'telmisartan', 'ginkgo biloba ext.', 'rescinnamine', 'cadralazine', 'bendroflumethiazide', 'nadolol', 'eprosartan mesylate (as eprosartan)', 'eprosartan mesylate(as eprosartan 400mg)', 'moexipril HCl', 'efonidipine', 'phentolamine mesylate', 'verapamil HCl', 'propranolol HCl', 'amlodipine camsylate (as amlodipine)', 'tertatolol HCl', 'fenoldopam mesylate(as fenoldopam 20mg)', 'nitrendipine', 'olmesartan medoxomil', 'bisoprolol fumarate', 'iloprost', 'olmesartan medoxomi', 'S-atenolol', 'S-amlodipine besylate (as S-amlodipine)', 'phenoxybenzamine', 'bosentan hydrate (as bosentan)', 'S-amlodipine nicotinate (as S-amlodipine)', 'nebivolol hydrochloride (as nebivolol)', 'nebivolol', 'aliskiren hemifumarate(as aliskiren)', 'perindopril arginine', 's-amlodipine camsylate(as s-amlodipine 2.5mg)', 'zofenopril calcium', 'treprostinil', 'fimasartan potassium trihydrate (as fimasartan potassium)', 'olmesartan cilexetil (as olmesartan)', 'lercanidipine hydrochloride', 'amlodipine adipate (as amlodipine)', 'amlodipine orotate (as amlodipine)', 'amlodipine oratate (as amlodipine)', 'amlodipine maleate(as amlodipine)', 's-amlodipine nicotinate(as s-amlodipine)', 'sildenafil citrate(as sildenafil)', 'ambrisentan', 'amlodipine', 'mepindolol sulfate', 'amlodipine besylate(as amlodipine)', 'Micronized Riociguat', 'Amlodipine Besylate', 'micronized macitentan', 'selexipag', 'S-carvedilol', 'azilsartan medoxomil potassium (as azilsartan medoxomil)', 'azelnidipine']  

# 파일 경로 및 파일명 
input_folder = r'C:\Users\USER\Desktop\기획\프로젝트\pdf\output_folder'
output_folder = r'C:\Users\USER\Desktop\기획\프로젝트\pdf\check_noti_output_folder'
os.makedirs(output_folder, exist_ok=True)  # 출력 폴더가 없으면 생성

# 현재 날짜 및 시간
now = datetime.now()
formatted_time = now.strftime("%Y%m%d_%H%M%S")

results = {}  # 각 ID에 대한 결과 저장

# 파일 탐색 및 처리
for file_name in os.listdir(input_folder):
    file_path = os.path.join(input_folder, file_name)

    # 파일이 medicine으로 끝나는 엑셀 파일인 경우만 처리
    if file_name.endswith('.xlsx') and 'medicine' in file_name:
        id_value = file_name.split('_')[0]  # 파일 이름에서 ID 추출

        try:
            df = pd.read_excel(file_path)

            # 진료 시작일 열을 날짜만 남기도록 수정
            df['진료시작일'] = pd.to_datetime(df['진료시작일']).dt.date
            
            # 진료 시작일 조건 확인
            for index, row in df.iterrows():
                treatment_start_date = row['진료시작일']  # 진료 시작일 열 이름에 맞게 수정
                ingredient_name = row['성분명']  # 성분명 열 이름에 맞게 수정

                # 결과 저장을 위한 딕셔너리 초기화
                if id_value not in results:
                    results[id_value] = {'106': [], '200': []}

                # 1번 조건: 진료 시작일이 오늘 날짜로부터 3개월 이내
                if pd.to_datetime(treatment_start_date) >= (now - timedelta(days=90)):
                    row_1 = row.copy()  # 행 복사하여 결과 1에 추가
                    row_1['상태'] = '투약(106)'  # 상태 필드 추가
                    results[id_value]['106'].append(row_1)  # 결과 1번에 추가
                
                # 2번 조건: 진료 시작일이 오늘 날짜로부터 3개월 이내이며 성분명이 특정 리스트에 포함되는 경우 (부분 일치)
                if (pd.to_datetime(treatment_start_date) >= (now - timedelta(days=90)) and
                    (any(ingredient in ingredient_name for ingredient in stimulants) or
                     any(ingredient in ingredient_name for ingredient in antihypertensives) or
                     any(ingredient in ingredient_name for ingredient in anxiolytics) or
                     any(ingredient in ingredient_name for ingredient in painkillers) or
                     any(ingredient in ingredient_name for ingredient in sleeping_pills))):
                    row_2 = row.copy()  # 행 복사하여 결과 2에 추가
                    row_2['상태'] = '특정 의약품 투약 (200)'  # 상태 필드 추가
                    results[id_value]['200'].append(row_2)  # 결과 2번에 추가

        except Exception as e:
            print(f"Error reading {file_path}: {e}")

# 결과 파일로 저장
for id_value, result_data in results.items():
    if result_data['106']:  # 결과 1번이 있을 경우
        result_file_1 = os.path.join(output_folder, f"{id_value}_106_{formatted_time}.xlsx")
        pd.DataFrame(result_data['106']).to_excel(result_file_1, index=False)

        # B열 너비 설정
        wb = load_workbook(result_file_1)
        ws = wb.active
        ws.column_dimensions['B'].width = 12  # B열의 너비를 12로 설정
        wb.save(result_file_1)  # 변경사항 저장
        wb.close()

    if result_data['200']:  # 결과 2번이 있을 경우
        result_file_2 = os.path.join(output_folder, f"{id_value}_200_{formatted_time}.xlsx")
        pd.DataFrame(result_data['200']).to_excel(result_file_2, index=False)
        
        # B열 너비 설정
        wb = load_workbook(result_file_2)
        ws = wb.active
        ws.column_dimensions['B'].width = 12  # B열의 너비를 12로 설정
        wb.save(result_file_2)  # 변경사항 저장
        wb.close()


print("결과 파일이 생성되었습니다.")